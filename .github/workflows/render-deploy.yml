name: ğŸš€ Deploy to Render

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸ¯ Deploy to Render
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: |
          backend/package-lock.json
          frontend/package-lock.json

    - name: ğŸ“¤ Trigger Render Deploy
      run: |
        echo "ğŸš€ Render will auto-deploy from main branch"
        echo "ğŸŒ Frontend: https://genshin-shop-frontend.onrender.com"
        echo "ğŸ”§ Backend: https://genshin-shop-backend.onrender.com"
        echo "ğŸ“Š MongoDB: genshin-mongodb (managed by Render)"

    - name: ğŸŒ Create Live Links Page
      run: |
        cat > live-urls.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <title>ğŸš€ Genshin Shop - Live URLs</title>
            <style>
                body { 
                    font-family: Arial; 
                    margin: 40px; 
                    background: #f5f5f5; 
                }
                .card { 
                    background: white; 
                    padding: 30px; 
                    margin: 20px 0; 
                    border-radius: 15px; 
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
                }
            </style>
        </head>
        <body>
            <h1>ğŸ® Genshin Shop - Live on Render</h1>
            
            <div class="card">
                <h2>ğŸŒ Production URLs</h2>
                <a href="https://genshin-shop-frontend.onrender.com" class="btn" target="_blank">
                    ğŸ›ï¸ Open Genshin Shop
                </a>
                <a href="https://genshin-shop-frontend.onrender.com/admin" class="btn" target="_blank">
                    âš™ï¸ Open Admin Panel
                </a>
                <p><strong>Frontend:</strong> https://genshin-shop-frontend.onrender.com</p>
                <p><strong>Backend API:</strong> https://genshin-shop-backend.onrender.com</p>
            </div>

            <div class="card">
                <h2>ğŸ“Š Deployment Info</h2>
                <p><strong>Platform:</strong> Render.com</p>
                <p><strong>Plan:</strong> Free Tier</p>
                <p><strong>Auto-deploy:</strong> On push to main</p>
            </div>
        </body>
        </html>
        EOF

        - name: ğŸ“¤ Upload Live URLs
          uses: actions/upload-artifact@v4
          with:
            name: live-urls
            path: live-urls.html
            retention-days: 90

        - name: ğŸ‰ Deployment Success
          run: |
            echo ""
            echo "ğŸ‰ ==========================================="
            echo "ğŸš€ RENDER DEPLOYMENT TRIGGERED!"
            echo "ğŸ‰ ==========================================="
            echo ""
            echo "ğŸŒ LIVE URLs (available in 5-10 minutes):"
            echo "   ğŸ›ï¸ Shop: https://genshin-shop-frontend.onrender.com"
            echo "   âš™ï¸ Admin: https://genshin-shop-frontend.onrender.com/admin"
            echo "   ğŸ”§ API: https://genshin-shop-backend.onrender.com"
            echo ""
            echo "ğŸ“Š Check progress at: https://dashboard.render.com"
            echo "==========================================="